---
title: 中间人攻击
pubDatetime: 2021-07-05T00:08:09.000Z
author: caorushizi
tags:
  - 前端安全
postSlug: 14e8fb3d09e3061e014599bf3949105e
description: >-
  中间人攻击（Man-in-the-middle attack,
  MITM），指攻击者与通讯的两端分别创建独立的联系，并交换其所收到的数据，使通讯的两端认为他们正在通过一个私密的连接与对方直接对话，但事实上整个会话都被攻击者窃听、篡改甚至完全控制。没有进行严格的证书校验是中间人攻击着手点。目前大多数加密协议都提供了一些特殊认证方法以阻止中间人攻击。如
  SSL （安全套接字层）协议可以验证参与通讯的用
difficulty: 2.5
questionNumber: 314
source: https://fe.ecool.fun/topic/825e3009-688d-43d4-ba62-0c4940d90ce9
---

<p><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">中间人攻击（Man-in-the-middle attack, MITM），指攻击者与通讯的两端分别创建独立的联系，并交换其所收到的数据，使通讯的两端认为他们正在通过一个私密的连接与对方直接对话，但事实上整个会话都被攻击者窃听、篡改甚至完全控制。没有进行严格的证书校验是中间人攻击着手点。目前大多数加密协议都提供了一些特殊认证方法以阻止中间人攻击。如 SSL （安全套接字层）协议可以验证参与通讯的用户的证书是否有权威、受信任的数字证书认证机构颁发，并且能执行双向身份认证。攻击场景如用户在一个未加密的 WiFi下访问网站。在中间人攻击中，攻击者可以拦截通讯双方的通话并插入新的内容。</span></span></span></span><br/><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx"><span style="font-size:14ptpx">场景</span></span></span></span><br/></p><ul><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">i）在一个未加密的Wi-Fi 无线接入点的接受范围内的中间人攻击者，可以将自己作为一个中间人插入这个网络</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">ii）Fiddler / Charles （花瓶）代理工具</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">iii）12306 之前的自己证书</span></span></span></span></li></ul><p><span style="font-size:14ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">过程</span></span></span></span><br/></p><ul><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">i）客户端发送请求到服务端，请求被中间人截获</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">ii）服务器向客户端发送公钥</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">iii）中间人截获公钥，保留在自己手上。然后自己生成一个【伪造的】公钥，发给客户端</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">iv）客户端收到伪造的公钥后，生成加密hash值发给服务器</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">v）中间人获得加密hash值，用自己的私钥解密获得真秘钥,同时生成假的加密hash值，发给服务器</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">vi）服务器用私钥解密获得假密钥,然后加密数据传输给客户端</span></span></span></span></li></ul><p><span style="font-size:14ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">使用抓包工具fiddle来进行举例说明</span></span></span></span><br/></p><ul><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">首先通过一些途径在客户端安装证书</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">然后客户端发送连接请求，fiddle在中间截取请求，并返回自己伪造的证书</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">客户端已经安装了攻击者的根证书，所以验证通过</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">客户端就会正常和fiddle进行通信，把fiddle当作正确的服务器</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">同时fiddle会跟原有的服务器进行通信，获取数据以及加密的密钥，去解密密钥</span></span></span></span></li></ul><p><span style="font-size:14ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">常见攻击方式</span></span></span></span><br/></p><ul><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">嗅探：嗅探是一种用来捕获流进和流出的网络数据包的技术，就好像是监听电话一样。比如：抓包工具</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">数据包注入：在这种，攻击者会将恶意数据包注入到常规数据中的，因为这些恶意数据包是在正常的数据包里面的，用户和系统都很难发现这个内容。</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">会话劫持：当我们进行一个网站的登录的时候到退出登录这个时候，会产生一个会话，这个会话是攻击者用来攻击的首要目标，因为这个会话，包含了用户大量的数据和私密信息。</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">SSL剥离：HTTPS是通过SSL/TLS进行加密过的，在SSL剥离攻击中，会使SSL/TLS连接断开，让受保护的HTTPS，变成不受</span></span></span></span></li></ul><p><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">保护的HTTP（这对于网站非常致命）</span></span></span></span><br/></p><ul><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">DNS欺骗，攻击者往往通过入侵到DNS服务器，或者篡改用户本地hosts文件，然后去劫持用户发送的请求，然后转发到攻击者想要转发到的服务器</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">ARP欺骗，ARP(address resolution protocol)地址解析协议，攻击者利用APR的漏洞，用当前局域网之间的一台服务器，来冒充客户端想要请求的服务端，向客户端发送自己的MAC地址，客户端无从得到真正的主机的MAC地址，所以，他会把这个地址当作真正</span></span></span></span></li></ul><p><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">的主机来进行通信，将MAC存入ARP缓存表。</span></span></span></span><br/></p><ul><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">代理服务器</span></span></span></span></li></ul><p><span style="font-size:14ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">预防方案：</span></span></span></span><br/></p><ul><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">i）用可信的第三方CA厂商</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">ii）不下载未知来源的证书，不要去下载一些不安全的文件</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">iii）确认你访问的URL是HTTPS的，确保网站使用了SSL，确保禁用一些不安全的SSL，只开启：TLS1.1，TLS1.2</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">iv）不要使用公用网络发送一些敏感的信息</span></span></span></span></li><li><span style="font-size:10.5ptpx"><span style="color:#24292e"><span style="background-color:#ffffff"><span style="letter-spacing:0ptpx">v）不要去点击一些不安全的连接或者恶意链接或邮件信息</span></span></span></span></li></ul><p><br/></p>
